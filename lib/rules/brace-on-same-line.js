"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectSpread3 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _lodash = require("lodash");

var _braceOnSameLine = require("eslint-plugin-brace-rules/lib/rules/brace-on-same-line");

var _enums = require("../enums");

var _styles, _messages;

var CLASS_DECLARATION = _enums.BlockTypes.CLASS_DECLARATION,
    CLASS_EXPRESSION = _enums.BlockTypes.CLASS_EXPRESSION,
    FUNCTION_EXPRESSION = _enums.BlockTypes.FUNCTION_EXPRESSION,
    METHOD_DEFINITION = _enums.BlockTypes.METHOD_DEFINITION;
var BODY = _enums.MessageIds.BODY,
    CLOSE = _enums.MessageIds.CLOSE,
    CLOSE_SINGLE = _enums.MessageIds.CLOSE_SINGLE,
    NO_SINGLE = _enums.MessageIds.NO_SINGLE,
    OPEN = _enums.MessageIds.OPEN,
    OPEN_ALLMAN = _enums.MessageIds.OPEN_ALLMAN;
var ALWAYS = _enums.PropertyValues.ALWAYS,
    IGNORE = _enums.PropertyValues.IGNORE,
    NEVER = _enums.PropertyValues.NEVER;
var ALLMAN = _enums.Styles.ALLMAN,
    OTBS = _enums.Styles.OTBS;
var blocks = [CLASS_DECLARATION, CLASS_EXPRESSION, FUNCTION_EXPRESSION, METHOD_DEFINITION];

var initStyles = function initStyles(value) {
  return blocks.reduce(function (acc, type) {
    acc[type] = value;
    return acc;
  }, {});
};

var styles = (_styles = {}, (0, _defineProperty2["default"])(_styles, OTBS, initStyles(ALWAYS)), (0, _defineProperty2["default"])(_styles, ALLMAN, initStyles(NEVER)), _styles);

var create = function create(context) {
  var _objectSpread2;

  var sourceCode = context.getSourceCode();
  var styleValue = context.options[0] || OTBS;
  var style = typeof styleValue === 'string' ? styles[styleValue] : styleValue;
  var options = (0, _objectSpread3["default"])({}, style, context.options[1]);
  blocks.forEach(function (type) {
    if (!(type in options)) return;

    if (options[type] === IGNORE) {
      delete options[type];
    } else {
      options[type] = options[type] === ALWAYS;
    }
  });

  var insertBreakBefore = function insertBreakBefore(token) {
    var whitespace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
    return function (fixer) {
      return fixer.insertTextBefore(token, "\n".concat(whitespace));
    };
  };

  var removeBreakBetween = function removeBreakBetween(startToken, endToken) {
    return function (fixer) {
      return fixer.replaceTextRange([startToken.range[1], endToken.range[0]], ' ');
    };
  };

  var getWhitespaceBefore = function getWhitespaceBefore(token) {
    if (!token || !token.loc) return '';
    var src = sourceCode.getText(token, token.loc.start.column);
    var indent = /^(\s+)/.exec(src);
    return indent ? indent[1] : '';
  };

  var checkBlock = function checkBlock(parentNode, expectSameLine) {
    var reportParent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    if (!('body' in parentNode) || !('type' in parentNode.body)) return;
    var type = parentNode.body.type;
    if (type !== 'BlockStatement' && type !== 'ClassBody') return;
    var node = parentNode.body;
    var previousToken = sourceCode.getTokenBefore(node);
    var curlyToken = sourceCode.getFirstToken(node);
    var curlyTokenEnd = sourceCode.getLastToken(node);
    if (!previousToken || !curlyTokenEnd || !curlyToken) return;
    var allOnSameLine = previousToken.loc.start.line === curlyTokenEnd.loc.start.line;
    var allowSingleLine = options.allowSingleLine;
    if (allowSingleLine && allOnSameLine) return;
    var reportNode = parentNode || node;
    var whitespace = getWhitespaceBefore(parentNode);

    if (allOnSameLine) {
      var reportDescriptor = {
        node: reportParent ? reportNode.parent : reportNode,
        messageId: NO_SINGLE,
        fix: insertBreakBefore(curlyTokenEnd, whitespace)
      };
      context.report(reportDescriptor);
      return;
    }

    var startSameLine = previousToken.loc.start.line === curlyToken.loc.start.line;

    if (startSameLine !== expectSameLine) {
      var _reportDescriptor = {
        node: reportParent ? reportNode.parent : reportNode,
        messageId: startSameLine ? OPEN_ALLMAN : OPEN,
        fix: startSameLine ? insertBreakBefore(curlyToken, whitespace) : removeBreakBetween(previousToken, curlyToken)
      };
      context.report(_reportDescriptor);
    }

    if (!('body' in node)) return;
    var body = node.body;
    if (!('length' in body) || !body.length) return;

    var _body = (0, _slicedToArray2["default"])(body, 1),
        first = _body[0];

    if (first.loc && first.loc.start.line === curlyToken.loc.start.line) {
      var _reportDescriptor2 = {
        node: first,
        messageId: BODY,
        fix: insertBreakBefore(curlyToken, (0, _lodash.repeat)(' ', first.loc.start.column))
      };
      context.report(_reportDescriptor2);
    }

    var lastToken = body[body.length - 1];
    var endOnSameLine = lastToken.loc && lastToken.loc.end.line === curlyTokenEnd.loc.end.line;

    if (endOnSameLine) {
      var _reportDescriptor3 = {
        node: lastToken,
        messageId: allowSingleLine ? CLOSE_SINGLE : CLOSE,
        fix: insertBreakBefore(curlyTokenEnd, whitespace)
      };
      context.report(_reportDescriptor3);
    }
  };

  var checkNode = function checkNode(type) {
    if (!(type in options)) return _lodash.noop;
    return function (node) {
      var _ref = node,
          parent = _ref.parent;
      var applyParent = type === FUNCTION_EXPRESSION && parent && parent.type === METHOD_DEFINITION && METHOD_DEFINITION in options;
      var expectSameLine = applyParent ? options[METHOD_DEFINITION] : options[type];
      checkBlock(node, expectSameLine, applyParent);
    };
  };

  var result = (0, _objectSpread3["default"])({}, (0, _braceOnSameLine.create)(context), (_objectSpread2 = {}, (0, _defineProperty2["default"])(_objectSpread2, CLASS_DECLARATION, checkNode(CLASS_DECLARATION)), (0, _defineProperty2["default"])(_objectSpread2, CLASS_EXPRESSION, checkNode(CLASS_EXPRESSION)), (0, _defineProperty2["default"])(_objectSpread2, FUNCTION_EXPRESSION, checkNode(FUNCTION_EXPRESSION)), (0, _defineProperty2["default"])(_objectSpread2, METHOD_DEFINITION, checkNode(METHOD_DEFINITION)), _objectSpread2));
  return result;
};

var rule = {
  create: create,
  meta: (0, _lodash.merge)({}, _braceOnSameLine.meta || {}, {
    schema: [{
      oneOf: [{}, {
        properties: {
          ClassDeclaration: {
            "enum": [ALWAYS, NEVER, IGNORE]
          }
        }
      }]
    }],
    messages: (_messages = {}, (0, _defineProperty2["default"])(_messages, BODY, 'Statement inside of curly braces should be on next line.'), (0, _defineProperty2["default"])(_messages, CLOSE, 'Closing curly brace does not appear on the same line as the subsequent block.'), (0, _defineProperty2["default"])(_messages, CLOSE_SINGLE, 'Closing curly brace should be on the same line as opening curly brace or on the line after the previous block.'), (0, _defineProperty2["default"])(_messages, NO_SINGLE, 'Single-line blocks defining is not allowed by configuration - brackets must be placed on different lines.'), (0, _defineProperty2["default"])(_messages, OPEN, 'Opening curly brace does not appear on the same line as controlling statement.'), (0, _defineProperty2["default"])(_messages, OPEN_ALLMAN, 'Opening curly brace appears on the same line as controlling statement.'), _messages)
  })
};
var _default = rule;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlcy9icmFjZS1vbi1zYW1lLWxpbmUudHMiXSwibmFtZXMiOlsiQ0xBU1NfREVDTEFSQVRJT04iLCJCbG9ja1R5cGVzIiwiQ0xBU1NfRVhQUkVTU0lPTiIsIkZVTkNUSU9OX0VYUFJFU1NJT04iLCJNRVRIT0RfREVGSU5JVElPTiIsIkJPRFkiLCJNZXNzYWdlSWRzIiwiQ0xPU0UiLCJDTE9TRV9TSU5HTEUiLCJOT19TSU5HTEUiLCJPUEVOIiwiT1BFTl9BTExNQU4iLCJBTFdBWVMiLCJQcm9wZXJ0eVZhbHVlcyIsIklHTk9SRSIsIk5FVkVSIiwiQUxMTUFOIiwiU3R5bGVzIiwiT1RCUyIsImJsb2NrcyIsImluaXRTdHlsZXMiLCJ2YWx1ZSIsInJlZHVjZSIsImFjYyIsInR5cGUiLCJzdHlsZXMiLCJjcmVhdGUiLCJjb250ZXh0Iiwic291cmNlQ29kZSIsImdldFNvdXJjZUNvZGUiLCJzdHlsZVZhbHVlIiwib3B0aW9ucyIsInN0eWxlIiwiZm9yRWFjaCIsImluc2VydEJyZWFrQmVmb3JlIiwidG9rZW4iLCJ3aGl0ZXNwYWNlIiwiZml4ZXIiLCJpbnNlcnRUZXh0QmVmb3JlIiwicmVtb3ZlQnJlYWtCZXR3ZWVuIiwic3RhcnRUb2tlbiIsImVuZFRva2VuIiwicmVwbGFjZVRleHRSYW5nZSIsInJhbmdlIiwiZ2V0V2hpdGVzcGFjZUJlZm9yZSIsImxvYyIsInNyYyIsImdldFRleHQiLCJzdGFydCIsImNvbHVtbiIsImluZGVudCIsImV4ZWMiLCJjaGVja0Jsb2NrIiwicGFyZW50Tm9kZSIsImV4cGVjdFNhbWVMaW5lIiwicmVwb3J0UGFyZW50IiwiYm9keSIsIm5vZGUiLCJwcmV2aW91c1Rva2VuIiwiZ2V0VG9rZW5CZWZvcmUiLCJjdXJseVRva2VuIiwiZ2V0Rmlyc3RUb2tlbiIsImN1cmx5VG9rZW5FbmQiLCJnZXRMYXN0VG9rZW4iLCJhbGxPblNhbWVMaW5lIiwibGluZSIsImFsbG93U2luZ2xlTGluZSIsInJlcG9ydE5vZGUiLCJyZXBvcnREZXNjcmlwdG9yIiwicGFyZW50IiwibWVzc2FnZUlkIiwiZml4IiwicmVwb3J0Iiwic3RhcnRTYW1lTGluZSIsImxlbmd0aCIsImZpcnN0IiwibGFzdFRva2VuIiwiZW5kT25TYW1lTGluZSIsImVuZCIsImNoZWNrTm9kZSIsIm5vb3AiLCJhcHBseVBhcmVudCIsInJlc3VsdCIsInJ1bGUiLCJtZXRhIiwiYmFzZU1ldGEiLCJzY2hlbWEiLCJvbmVPZiIsInByb3BlcnRpZXMiLCJDbGFzc0RlY2xhcmF0aW9uIiwibWVzc2FnZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUVBOzs7O0lBUUVBLGlCLEdBSUVDLGlCLENBSkZELGlCO0lBQ0FFLGdCLEdBR0VELGlCLENBSEZDLGdCO0lBQ0FDLG1CLEdBRUVGLGlCLENBRkZFLG1CO0lBQ0FDLGlCLEdBQ0VILGlCLENBREZHLGlCO0lBSUFDLEksR0FNRUMsaUIsQ0FORkQsSTtJQUNBRSxLLEdBS0VELGlCLENBTEZDLEs7SUFDQUMsWSxHQUlFRixpQixDQUpGRSxZO0lBQ0FDLFMsR0FHRUgsaUIsQ0FIRkcsUztJQUNBQyxJLEdBRUVKLGlCLENBRkZJLEk7SUFDQUMsVyxHQUNFTCxpQixDQURGSyxXO0lBR01DLE0sR0FBMEJDLHFCLENBQTFCRCxNO0lBQVFFLE0sR0FBa0JELHFCLENBQWxCQyxNO0lBQVFDLEssR0FBVUYscUIsQ0FBVkUsSztJQUNoQkMsTSxHQUFpQkMsYSxDQUFqQkQsTTtJQUFRRSxJLEdBQVNELGEsQ0FBVEMsSTtBQVloQixJQUFNQyxNQUFvQixHQUFHLENBQzNCbkIsaUJBRDJCLEVBRTNCRSxnQkFGMkIsRUFHM0JDLG1CQUgyQixFQUkzQkMsaUJBSjJCLENBQTdCOztBQU9BLElBQU1nQixVQUFVLEdBQUcsU0FBU0EsVUFBVCxDQUFvQkMsS0FBcEIsRUFBNkQ7QUFDOUUsU0FBT0YsTUFBTSxDQUFDRyxNQUFQLENBQWMsVUFBQ0MsR0FBRCxFQUF3QkMsSUFBeEIsRUFBbUQ7QUFDdEVELElBQUFBLEdB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QUFGc0IsQ0FBOUI7ZUFnQ2V3RSxJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUnVsZSwgQVNULCBTb3VyY2VDb2RlIH0gZnJvbSAnZXNsaW50JztcbmltcG9ydCB7IEJsb2NrU3RhdGVtZW50LCBDbGFzc0JvZHksIE5vZGUgfSBmcm9tICdlc3RyZWUnOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGltcG9ydC9uby11bnJlc29sdmVkXG5pbXBvcnQgeyBtZXJnZSwgbm9vcCwgcmVwZWF0LCBEaWN0aW9uYXJ5IH0gZnJvbSAnbG9kYXNoJzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBvYmplY3QtY3VybHktbmV3bGluZVxuaW1wb3J0IHsgY3JlYXRlIGFzIGNyZWF0ZUJhc2UsIG1ldGEgYXMgYmFzZU1ldGEgfSBmcm9tICdlc2xpbnQtcGx1Z2luLWJyYWNlLXJ1bGVzL2xpYi9ydWxlcy9icmFjZS1vbi1zYW1lLWxpbmUnO1xuXG5pbXBvcnQge1xuICBCbG9ja1R5cGVzLFxuICBNZXNzYWdlSWRzLFxuICBQcm9wZXJ0eVZhbHVlcyxcbiAgU3R5bGVzLFxufSBmcm9tICcuLi9lbnVtcyc7XG5cbmNvbnN0IHtcbiAgQ0xBU1NfREVDTEFSQVRJT04sXG4gIENMQVNTX0VYUFJFU1NJT04sXG4gIEZVTkNUSU9OX0VYUFJFU1NJT04sXG4gIE1FVEhPRF9ERUZJTklUSU9OLFxufSA9IEJsb2NrVHlwZXM7XG5cbmNvbnN0IHtcbiAgQk9EWSxcbiAgQ0xPU0UsXG4gIENMT1NFX1NJTkdMRSxcbiAgTk9fU0lOR0xFLFxuICBPUEVOLFxuICBPUEVOX0FMTE1BTixcbn0gPSBNZXNzYWdlSWRzO1xuXG5jb25zdCB7IEFMV0FZUywgSUdOT1JFLCBORVZFUiB9ID0gUHJvcGVydHlWYWx1ZXM7XG5jb25zdCB7IEFMTE1BTiwgT1RCUyB9ID0gU3R5bGVzO1xuXG5pbnRlcmZhY2UgQmxvY2tQYXJlbnQgZXh0ZW5kcyBCbG9ja1N0YXRlbWVudCB7XG4gIHBhcmVudDogTm9kZTtcbn1cblxudHlwZSBGaXhlciA9IChmaXhlcjogUnVsZS5SdWxlRml4ZXIpID0+IFJ1bGUuRml4O1xudHlwZSBTdHlsZXNEaWN0aW9uYXJ5ID0gRGljdGlvbmFyeTxTdHJpbmdEaWN0aW9uYXJ5PjtcbnR5cGUgU3RyaW5nRGljdGlvbmFyeSA9IERpY3Rpb25hcnk8c3RyaW5nPjtcbnR5cGUgQm9keSA9IEJsb2NrU3RhdGVtZW50IHwgQ2xhc3NCb2R5O1xudHlwZSBDaGVja05vZGUgPSAobm9kZTogTm9kZSkgPT4gdm9pZDtcblxuY29uc3QgYmxvY2tzOiBCbG9ja1R5cGVzW10gPSBbXG4gIENMQVNTX0RFQ0xBUkFUSU9OLFxuICBDTEFTU19FWFBSRVNTSU9OLFxuICBGVU5DVElPTl9FWFBSRVNTSU9OLFxuICBNRVRIT0RfREVGSU5JVElPTixcbl07XG5cbmNvbnN0IGluaXRTdHlsZXMgPSBmdW5jdGlvbiBpbml0U3R5bGVzKHZhbHVlOiBQcm9wZXJ0eVZhbHVlcyk6IFN0cmluZ0RpY3Rpb25hcnkge1xuICByZXR1cm4gYmxvY2tzLnJlZHVjZSgoYWNjOiBTdHJpbmdEaWN0aW9uYXJ5LCB0eXBlKTogU3RyaW5nRGljdGlvbmFyeSA9PiB7XG4gICAgYWNjW3R5cGVdID0gdmFsdWU7XG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufTtcblxuY29uc3Qgc3R5bGVzOiBTdHlsZXNEaWN0aW9uYXJ5ID0ge1xuICBbT1RCU106IGluaXRTdHlsZXMoQUxXQVlTKSxcbiAgW0FMTE1BTl06IGluaXRTdHlsZXMoTkVWRVIpLFxufTtcblxuY29uc3QgY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKGNvbnRleHQ6IFJ1bGUuUnVsZUNvbnRleHQpOiBSdWxlLlJ1bGVMaXN0ZW5lciB7XG4gIGNvbnN0IHNvdXJjZUNvZGU6IFNvdXJjZUNvZGUgPSBjb250ZXh0LmdldFNvdXJjZUNvZGUoKTtcbiAgY29uc3Qgc3R5bGVWYWx1ZTogc3RyaW5nIHwgU3RyaW5nRGljdGlvbmFyeSA9IGNvbnRleHQub3B0aW9uc1swXSB8fCBPVEJTO1xuICBjb25zdCBzdHlsZTogU3RyaW5nRGljdGlvbmFyeSA9IHR5cGVvZiBzdHlsZVZhbHVlID09PSAnc3RyaW5nJyA/IHN0eWxlc1tzdHlsZVZhbHVlXSA6IHN0eWxlVmFsdWU7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IHsgLi4uc3R5bGUsIC4uLmNvbnRleHQub3B0aW9uc1sxXSB9O1xuXG4gIGJsb2Nrcy5mb3JFYWNoKCh0eXBlOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICBpZiAoISh0eXBlIGluIG9wdGlvbnMpKSByZXR1cm47XG4gICAgaWYgKG9wdGlvbnNbdHlwZV0gPT09IElHTk9SRSkge1xuICAgICAgZGVsZXRlIG9wdGlvbnNbdHlwZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wdGlvbnNbdHlwZV0gPSBvcHRpb25zW3R5cGVdID09PSBBTFdBWVM7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBpbnNlcnRCcmVha0JlZm9yZSA9IGZ1bmN0aW9uIGluc2VydEJyZWFrQmVmb3JlKHRva2VuOiBBU1QuVG9rZW4sIHdoaXRlc3BhY2UgPSAnJyk6IEZpeGVyIHtcbiAgICByZXR1cm4gKGZpeGVyOiBSdWxlLlJ1bGVGaXhlcik6IFJ1bGUuRml4ID0+IGZpeGVyLmluc2VydFRleHRCZWZvcmUodG9rZW4sIGBcXG4ke3doaXRlc3BhY2V9YCk7XG4gIH07XG5cbiAgY29uc3QgcmVtb3ZlQnJlYWtCZXR3ZWVuID0gZnVuY3Rpb24gcmVtb3ZlQnJlYWtCZXR3ZWVuKHN0YXJ0VG9rZW46IEFTVC5Ub2tlbiwgZW5kVG9rZW46IEFTVC5Ub2tlbik6IEZpeGVyIHtcbiAgICByZXR1cm4gKGZpeGVyOiBSdWxlLlJ1bGVGaXhlcik6IFJ1bGUuRml4ID0+IGZpeGVyLnJlcGxhY2VUZXh0UmFuZ2UoW1xuICAgICAgc3RhcnRUb2tlbi5yYW5nZVsxXSxcbiAgICAgIGVuZFRva2VuLnJhbmdlWzBdLFxuICAgIF0sICcgJyk7XG4gIH07XG5cbiAgY29uc3QgZ2V0V2hpdGVzcGFjZUJlZm9yZSA9IGZ1bmN0aW9uIGdldFdoaXRlc3BhY2VCZWZvcmUodG9rZW46IE5vZGUpOiBzdHJpbmcge1xuICAgIGlmICghdG9rZW4gfHwgIXRva2VuLmxvYykgcmV0dXJuICcnO1xuXG4gICAgY29uc3Qgc3JjID0gc291cmNlQ29kZS5nZXRUZXh0KHRva2VuLCB0b2tlbi5sb2Muc3RhcnQuY29sdW1uKTtcbiAgICBjb25zdCBpbmRlbnQgPSAoL14oXFxzKykvKS5leGVjKHNyYyk7XG5cbiAgICByZXR1cm4gaW5kZW50ID8gaW5kZW50WzFdIDogJyc7XG4gIH07XG5cbiAgY29uc3QgY2hlY2tCbG9jayA9IGZ1bmN0aW9uIGNoZWNrQmxvY2soXG4gICAgcGFyZW50Tm9kZTogTm9kZSxcbiAgICBleHBlY3RTYW1lTGluZTogYm9vbGVhbixcbiAgICByZXBvcnRQYXJlbnQ6IGJvb2xlYW4gPSBmYWxzZSxcbiAgKTogdm9pZCB7XG4gICAgaWYgKCEoJ2JvZHknIGluIHBhcmVudE5vZGUpIHx8ICEoJ3R5cGUnIGluIHBhcmVudE5vZGUuYm9keSkpIHJldHVybjtcblxuICAgIGNvbnN0IHsgdHlwZSB9ID0gcGFyZW50Tm9kZS5ib2R5O1xuICAgIGlmICh0eXBlICE9PSAnQmxvY2tTdGF0ZW1lbnQnICYmIHR5cGUgIT09ICdDbGFzc0JvZHknKSByZXR1cm47XG5cbiAgICBjb25zdCBub2RlID0gcGFyZW50Tm9kZS5ib2R5O1xuICAgIGNvbnN0IHByZXZpb3VzVG9rZW4gPSBzb3VyY2VDb2RlLmdldFRva2VuQmVmb3JlKG5vZGUpO1xuICAgIGNvbnN0IGN1cmx5VG9rZW4gPSBzb3VyY2VDb2RlLmdldEZpcnN0VG9rZW4obm9kZSk7XG4gICAgY29uc3QgY3VybHlUb2tlbkVuZCA9IHNvdXJjZUNvZGUuZ2V0TGFzdFRva2VuKG5vZGUpO1xuICAgIGlmICghcHJldmlvdXNUb2tlbiB8fCAhY3VybHlUb2tlbkVuZCB8fCAhY3VybHlUb2tlbikgcmV0dXJuO1xuXG4gICAgY29uc3QgYWxsT25TYW1lTGluZSA9IHByZXZpb3VzVG9rZW4ubG9jLnN0YXJ0LmxpbmUgPT09IGN1cmx5VG9rZW5FbmQubG9jLnN0YXJ0LmxpbmU7XG4gICAgY29uc3QgeyBhbGxvd1NpbmdsZUxpbmUgfSA9IG9wdGlvbnM7XG4gICAgaWYgKGFsbG93U2luZ2xlTGluZSAmJiBhbGxPblNhbWVMaW5lKSByZXR1cm47XG5cbiAgICBjb25zdCByZXBvcnROb2RlID0gKHBhcmVudE5vZGUgfHwgbm9kZSkgYXMgQmxvY2tQYXJlbnQ7XG4gICAgY29uc3Qgd2hpdGVzcGFjZSA9IGdldFdoaXRlc3BhY2VCZWZvcmUocGFyZW50Tm9kZSk7XG4gICAgaWYgKGFsbE9uU2FtZUxpbmUpIHtcbiAgICAgIGNvbnN0IHJlcG9ydERlc2NyaXB0b3I6IFJ1bGUuUmVwb3J0RGVzY3JpcHRvciA9IHtcbiAgICAgICAgbm9kZTogcmVwb3J0UGFyZW50ID8gcmVwb3J0Tm9kZS5wYXJlbnQgOiByZXBvcnROb2RlLFxuICAgICAgICBtZXNzYWdlSWQ6IE5PX1NJTkdMRSxcbiAgICAgICAgZml4OiBpbnNlcnRCcmVha0JlZm9yZShjdXJseVRva2VuRW5kLCB3aGl0ZXNwYWNlKSxcbiAgICAgIH07XG4gICAgICBjb250ZXh0LnJlcG9ydChyZXBvcnREZXNjcmlwdG9yKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFydFNhbWVMaW5lID0gcHJldmlvdXNUb2tlbi5sb2Muc3RhcnQubGluZSA9PT0gY3VybHlUb2tlbi5sb2Muc3RhcnQubGluZTtcbiAgICBpZiAoc3RhcnRTYW1lTGluZSAhPT0gZXhwZWN0U2FtZUxpbmUpIHtcbiAgICAgIGNvbnN0IHJlcG9ydERlc2NyaXB0b3I6IFJ1bGUuUmVwb3J0RGVzY3JpcHRvciA9IHtcbiAgICAgICAgbm9kZTogcmVwb3J0UGFyZW50ID8gcmVwb3J0Tm9kZS5wYXJlbnQgOiByZXBvcnROb2RlLFxuICAgICAgICBtZXNzYWdlSWQ6IHN0YXJ0U2FtZUxpbmUgPyBPUEVOX0FMTE1BTiA6IE9QRU4sXG4gICAgICAgIGZpeDogc3RhcnRTYW1lTGluZSA/IGluc2VydEJyZWFrQmVmb3JlKGN1cmx5VG9rZW4sIHdoaXRlc3BhY2UpIDogcmVtb3ZlQnJlYWtCZXR3ZWVuKHByZXZpb3VzVG9rZW4sIGN1cmx5VG9rZW4pLFxuICAgICAgfTtcbiAgICAgIGNvbnRleHQucmVwb3J0KHJlcG9ydERlc2NyaXB0b3IpO1xuICAgIH1cblxuICAgIGlmICghKCdib2R5JyBpbiBub2RlKSkgcmV0dXJuO1xuICAgIGNvbnN0IHsgYm9keSB9ID0gbm9kZTtcblxuICAgIGlmICghKCdsZW5ndGgnIGluIGJvZHkpIHx8ICFib2R5Lmxlbmd0aCkgcmV0dXJuO1xuICAgIGNvbnN0IFtmaXJzdF0gPSBib2R5O1xuXG4gICAgaWYgKGZpcnN0LmxvYyAmJiBmaXJzdC5sb2Muc3RhcnQubGluZSA9PT0gY3VybHlUb2tlbi5sb2Muc3RhcnQubGluZSkge1xuICAgICAgY29uc3QgcmVwb3J0RGVzY3JpcHRvcjogUnVsZS5SZXBvcnREZXNjcmlwdG9yID0ge1xuICAgICAgICBub2RlOiBmaXJzdCxcbiAgICAgICAgbWVzc2FnZUlkOiBCT0RZLFxuICAgICAgICBmaXg6IGluc2VydEJyZWFrQmVmb3JlKGN1cmx5VG9rZW4sIHJlcGVhdCgnICcsIGZpcnN0LmxvYy5zdGFydC5jb2x1bW4pKSxcbiAgICAgIH07XG4gICAgICBjb250ZXh0LnJlcG9ydChyZXBvcnREZXNjcmlwdG9yKTtcbiAgICB9XG5cbiAgICBjb25zdCBsYXN0VG9rZW4gPSBib2R5W2JvZHkubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgZW5kT25TYW1lTGluZSA9IGxhc3RUb2tlbi5sb2MgJiYgbGFzdFRva2VuLmxvYy5lbmQubGluZSA9PT0gY3VybHlUb2tlbkVuZC5sb2MuZW5kLmxpbmU7XG4gICAgaWYgKGVuZE9uU2FtZUxpbmUpIHtcbiAgICAgIGNvbnN0IHJlcG9ydERlc2NyaXB0b3I6IFJ1bGUuUmVwb3J0RGVzY3JpcHRvciA9IHtcbiAgICAgICAgbm9kZTogbGFzdFRva2VuLFxuICAgICAgICBtZXNzYWdlSWQ6IGFsbG93U2luZ2xlTGluZSA/IENMT1NFX1NJTkdMRSA6IENMT1NFLFxuICAgICAgICBmaXg6IGluc2VydEJyZWFrQmVmb3JlKGN1cmx5VG9rZW5FbmQsIHdoaXRlc3BhY2UpLFxuICAgICAgfTtcbiAgICAgIGNvbnRleHQucmVwb3J0KHJlcG9ydERlc2NyaXB0b3IpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjaGVja05vZGUgPSBmdW5jdGlvbiBjaGVja05vZGUodHlwZTogc3RyaW5nKTogQ2hlY2tOb2RlIHtcbiAgICBpZiAoISh0eXBlIGluIG9wdGlvbnMpKSByZXR1cm4gbm9vcDtcblxuICAgIHJldHVybiAobm9kZTogTm9kZSk6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgeyBwYXJlbnQgfSA9IG5vZGUgYXMgQmxvY2tQYXJlbnQ7XG4gICAgICBjb25zdCBhcHBseVBhcmVudCA9IChcbiAgICAgICAgdHlwZSA9PT0gRlVOQ1RJT05fRVhQUkVTU0lPTlxuICAgICAgICAmJiBwYXJlbnRcbiAgICAgICAgJiYgcGFyZW50LnR5cGUgPT09IE1FVEhPRF9ERUZJTklUSU9OXG4gICAgICAgICYmIE1FVEhPRF9ERUZJTklUSU9OIGluIG9wdGlvbnNcbiAgICAgICk7XG4gICAgICBjb25zdCBleHBlY3RTYW1lTGluZTogYm9vbGVhbiA9IGFwcGx5UGFyZW50ID8gb3B0aW9uc1tNRVRIT0RfREVGSU5JVElPTl0gOiBvcHRpb25zW3R5cGVdO1xuXG4gICAgICBjaGVja0Jsb2NrKG5vZGUsIGV4cGVjdFNhbWVMaW5lLCBhcHBseVBhcmVudCk7XG4gICAgfTtcbiAgfTtcblxuICBjb25zdCByZXN1bHQ6IFJ1bGUuUnVsZUxpc3RlbmVyID0ge1xuICAgIC4uLmNyZWF0ZUJhc2UoY29udGV4dCksXG4gICAgW0NMQVNTX0RFQ0xBUkFUSU9OXTogY2hlY2tOb2RlKENMQVNTX0RFQ0xBUkFUSU9OKSxcbiAgICBbQ0xBU1NfRVhQUkVTU0lPTl06IGNoZWNrTm9kZShDTEFTU19FWFBSRVNTSU9OKSxcbiAgICBbRlVOQ1RJT05fRVhQUkVTU0lPTl06IGNoZWNrTm9kZShGVU5DVElPTl9FWFBSRVNTSU9OKSxcbiAgICBbTUVUSE9EX0RFRklOSVRJT05dOiBjaGVja05vZGUoTUVUSE9EX0RFRklOSVRJT04pLFxuICB9O1xuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5jb25zdCBydWxlOiBSdWxlLlJ1bGVNb2R1bGUgPSB7XG4gIGNyZWF0ZSxcbiAgbWV0YTogbWVyZ2UoXG4gICAge30sXG4gICAgYmFzZU1ldGEgfHwge30sXG4gICAge1xuICAgICAgc2NoZW1hOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBvbmVPZjogW1xuICAgICAgICAgICAge30sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICBDbGFzc0RlY2xhcmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICBlbnVtOiBbQUxXQVlTLCBORVZFUiwgSUdOT1JFXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgIFtCT0RZXTogJ1N0YXRlbWVudCBpbnNpZGUgb2YgY3VybHkgYnJhY2VzIHNob3VsZCBiZSBvbiBuZXh0IGxpbmUuJyxcbiAgICAgICAgW0NMT1NFXTogJ0Nsb3NpbmcgY3VybHkgYnJhY2UgZG9lcyBub3QgYXBwZWFyIG9uIHRoZSBzYW1lIGxpbmUgYXMgdGhlIHN1YnNlcXVlbnQgYmxvY2suJyxcbiAgICAgICAgW0NMT1NFX1NJTkdMRV06ICdDbG9zaW5nIGN1cmx5IGJyYWNlIHNob3VsZCBiZSBvbiB0aGUgc2FtZSBsaW5lIGFzIG9wZW5pbmcgY3VybHkgYnJhY2Ugb3Igb24gdGhlIGxpbmUgYWZ0ZXIgdGhlIHByZXZpb3VzIGJsb2NrLicsXG4gICAgICAgIFtOT19TSU5HTEVdOiAnU2luZ2xlLWxpbmUgYmxvY2tzIGRlZmluaW5nIGlzIG5vdCBhbGxvd2VkIGJ5IGNvbmZpZ3VyYXRpb24gLSBicmFja2V0cyBtdXN0IGJlIHBsYWNlZCBvbiBkaWZmZXJlbnQgbGluZXMuJyxcbiAgICAgICAgW09QRU5dOiAnT3BlbmluZyBjdXJseSBicmFjZSBkb2VzIG5vdCBhcHBlYXIgb24gdGhlIHNhbWUgbGluZSBhcyBjb250cm9sbGluZyBzdGF0ZW1lbnQuJyxcbiAgICAgICAgW09QRU5fQUxMTUFOXTogJ09wZW5pbmcgY3VybHkgYnJhY2UgYXBwZWFycyBvbiB0aGUgc2FtZSBsaW5lIGFzIGNvbnRyb2xsaW5nIHN0YXRlbWVudC4nLFxuICAgICAgfSxcbiAgICB9LFxuICApLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgcnVsZTtcbiJdfQ==